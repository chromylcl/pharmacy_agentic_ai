This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
AdminDashboard.jsx
App.css
App.jsx
assets/react.svg
components/Admin/AnalyticsCharts.jsx
components/Admin/InventoryTable.jsx
components/Admin/LangfuseMetrics.jsx
components/Admin/RefillAlerts.jsx
components/Chat/AgentExpander.jsx
components/Chat/ChatWindow.jsx
components/Chat/EmergencyOverlay.jsx
components/Chat/MessageBubble.jsx
components/Chat/PrescriptionUpload.jsx
components/Chat/QuickActions.jsx
components/Chat/VoiceInput.jsx
components/Store/CartDrawer.jsx
components/Store/ProductGrid.jsx
components/UI/Loader.jsx
components/UI/Navbar.jsx
context/PharmacyContext.jsx
hooks/useAgent.js
hooks/useAgentStream.js
index.css
main.jsx
pages/AdminPortal.jsx
pages/Onboarding.jsx
pages/Storefront.jsx
pages/UserChat.jsx
services/api.js
styles/LiquidGlass.css
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="AdminDashboard.jsx">
import React, { useEffect, useState } from 'react';
import axios from 'axios';
import { AlertTriangle, Package, CheckCircle } from 'lucide-react';

const AdminDashboard = () => {
  const [inventory, setInventory] = useState([]);

  useEffect(() => {
    // This calls the FastAPI backend you set up earlier
    axios.get('http://127.0.0.1:8000/inventory')
      .then(res => setInventory(res.data))
      .catch(err => console.error("Backend not reachable:", err));
  }, []);

  return (
    <div className="p-8">
      <div className="flex justify-between items-center mb-8">
        <h1 className="text-3xl font-bold flex items-center gap-3">
          <Package className="text-emerald-400" size={32} /> 
          Inventory Status
        </h1>
        <div className="bg-slate-800 border border-slate-700 px-4 py-2 rounded-lg text-sm">
          Total Items: <span className="text-emerald-400 font-mono">{inventory.length}</span>
        </div>
      </div>
      
      <div className="bg-slate-800 rounded-xl border border-slate-700 overflow-hidden shadow-2xl">
        <table className="w-full text-left border-collapse">
          <thead className="bg-slate-700/50 text-slate-400 text-xs uppercase tracking-wider">
            <tr>
              <th className="px-6 py-4">Medicine</th>
              <th className="px-6 py-4">Stock</th>
              <th className="px-6 py-4">Rx Required</th>
              <th className="px-6 py-4">Alerts</th>
            </tr>
          </thead>
          <tbody className="divide-y divide-slate-700">
            {inventory.map((item, idx) => (
              <tr key={idx} className="hover:bg-slate-700/30 transition-colors">
                <td className="px-6 py-4 font-semibold text-slate-200">{item.name}</td>
                <td className="px-6 py-4">
                  <span className="font-mono">{item.stock}</span> 
                  <span className="text-slate-500 text-sm ml-1">{item.unit}</span>
                </td>
                <td className="px-6 py-4">
                  {item.prescription_required ? (
                    <span className="bg-red-500/10 text-red-400 px-2 py-1 rounded text-xs border border-red-500/20">Required</span>
                  ) : (
                    <span className="bg-slate-700 text-slate-400 px-2 py-1 rounded text-xs">OTC</span>
                  )}
                </td>
                <td className="px-6 py-4">
                  {item.stock < 15 ? (
                    <span className="text-amber-400 flex items-center gap-1 text-sm">
                      <AlertTriangle size={14} /> Low Stock
                    </span>
                  ) : (
                    <span className="text-emerald-500 flex items-center gap-1 text-sm">
                      <CheckCircle size={14} /> OK
                    </span>
                  )}
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
};

export default AdminDashboard;
</file>

<file path="App.css">
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}
</file>

<file path="App.jsx">
import { useState } from 'react';
import { usePharmacy } from './context/PharmacyContext';
import Onboarding from './pages/Onboarding';
import Navbar from './components/UI/Navbar';
import UserChat from './pages/UserChat';
import Storefront from './pages/Storefront';
import AdminPortal from './pages/AdminPortal';

function App() {
  const { isAuth } = usePharmacy();
  const [activeTab, setActiveTab] = useState('chat');

  return (
    <div className="relative min-h-screen overflow-hidden">
      
      {/* Main App Container - Blurs out beautifully if Onboarding is active */}
      <div className={`relative z-10 h-screen flex flex-col transition-all duration-1000 ${
        !isAuth ? 'blur-2xl scale-95 opacity-40 pointer-events-none' : 'blur-0 scale-100 opacity-100'
      }`}>
        
        

        {/* The Premium Floating Navbar */}
        <Navbar activeTab={activeTab} setActiveTab={setActiveTab} />
        
        {/* The Main Content Area (Cockpit) */}
        <main className="flex-1 w-full flex flex-col overflow-hidden">
          {activeTab === 'chat' && <UserChat />}
          {activeTab === 'store' && <Storefront />}
          {activeTab === 'admin' && <AdminPortal />}
        </main>
      </div>

      {/* Full Screen Onboarding Gate Overlay */}
      {!isAuth && (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-white/10 backdrop-blur-md">
          <Onboarding />
        </div>
      )}
    </div>
  );
}

export default App;
</file>

<file path="assets/react.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>
</file>

<file path="components/Admin/AnalyticsCharts.jsx">

</file>

<file path="components/Admin/InventoryTable.jsx">

</file>

<file path="components/Admin/LangfuseMetrics.jsx">

</file>

<file path="components/Admin/RefillAlerts.jsx">

</file>

<file path="components/Chat/AgentExpander.jsx">
import { useState } from 'react';
import { Brain, Stethoscope, Pill, ShieldAlert, Package, CreditCard, RotateCcw, CheckCircle2, ChevronDown, ChevronUp, Loader2 } from 'lucide-react';

// Mapping your friend's 7 agents to premium colors and icons
const AGENT_CONFIG = {
  orchestrator: { icon: Brain, color: 'text-purple-500', bg: 'bg-purple-500/10', border: 'border-purple-200', label: 'Orchestrator Agent' },
  physician: { icon: Stethoscope, color: 'text-blue-500', bg: 'bg-blue-500/10', border: 'border-blue-200', label: 'GP Agent' },
  pharmacist: { icon: Pill, color: 'text-emerald-500', bg: 'bg-emerald-500/10', border: 'border-emerald-200', label: 'Pharmacist Agent' },
  regulatory: { icon: ShieldAlert, color: 'text-amber-500', bg: 'bg-amber-500/10', border: 'border-amber-200', label: 'Regulatory Agent' },
  inventory: { icon: Package, color: 'text-orange-500', bg: 'bg-orange-500/10', border: 'border-orange-200', label: 'Inventory Agent' },
  billing: { icon: CreditCard, color: 'text-slate-600', bg: 'bg-slate-600/10', border: 'border-slate-200', label: 'Billing Agent' },
  refill: { icon: RotateCcw, color: 'text-teal-500', bg: 'bg-teal-500/10', border: 'border-teal-200', label: 'Refill Agent' }
};

const AgentExpander = ({ activeAgents, traces }) => {
  // Auto-expands when running, user can collapse when done
  const [isExpanded, setIsExpanded] = useState(true);
  const isRunning = Object.values(activeAgents).includes('thinking');

  if (Object.keys(activeAgents).length === 0) return null;

  return (
    <div className="w-full max-w-[85%] mt-2 mb-6 animate-in fade-in slide-in-from-top-2 duration-500">
      {/* Expander Header */}
      <button 
        onClick={() => setIsExpanded(!isExpanded)}
        className="flex items-center gap-2 text-xs font-semibold text-slate-500 hover:text-slate-700 transition-colors px-2 py-1 bg-white/40 rounded-full border border-white/60 shadow-sm backdrop-blur-md"
      >
        {isRunning ? (
          <><Loader2 size={12} className="animate-spin text-emerald-500" /> AI Agents computing...</>
        ) : (
          <><CheckCircle2 size={12} className="text-emerald-500" /> Multi-Agent task complete</>
        )}
        {isExpanded ? <ChevronUp size={14} /> : <ChevronDown size={14} />}
      </button>

      {/* The Chain of Thought Glass Panel */}
      {isExpanded && (
        <div className="mt-3 glass-panel p-4 space-y-3 border-l-4 border-l-slate-300">
          {Object.entries(activeAgents).map(([agentKey, status]) => {
            if (status === 'idle') return null; // Don't show agents that haven't started
            
            const config = AGENT_CONFIG[agentKey] || AGENT_CONFIG.orchestrator;
            const Icon = config.icon;

            return (
              <div key={agentKey} className={`flex items-start gap-3 p-3 rounded-2xl bg-white/50 border ${config.border} shadow-sm transition-all duration-500`}>
                <div className={`p-2 rounded-xl ${config.bg} ${config.color}`}>
                  {status === 'thinking' ? <Loader2 size={16} className="animate-spin" /> : <Icon size={16} />}
                </div>
                
                <div className="flex-1">
                  <div className="flex items-center justify-between">
                    <span className={`text-xs font-bold uppercase tracking-wider ${config.color}`}>
                      {config.label}
                    </span>
                    {status === 'done' && <CheckCircle2 size={14} className="text-emerald-500" />}
                  </div>
                  
                  {/* Here is where the word-by-word streaming thoughts will go later */}
                  <div className="mt-1 text-sm text-slate-600 font-medium">
                    {status === 'thinking' 
                      ? "Analyzing query parameters and retrieving context..." 
                      : traces[agentKey] || "Task completed successfully."}
                  </div>
                </div>
              </div>
            );
          })}
        </div>
      )}
    </div>
  );
};

export default AgentExpander;
</file>

<file path="components/Chat/ChatWindow.jsx">

</file>

<file path="components/Chat/EmergencyOverlay.jsx">
import { AlertTriangle, PhoneCall, ArrowLeft, ShieldAlert } from 'lucide-react';

const EmergencyOverlay = ({ isOpen, onClose, triggerWord }) => {
  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-rose-950/80 backdrop-blur-xl animate-in fade-in duration-500">
      
      {/* Background pulsing effect */}
      <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
        <div className="w-[50vw] h-[50vw] bg-rose-600/20 rounded-full blur-[100px] animate-pulse duration-1000"></div>
      </div>

      <div className="glass-panel relative w-full max-w-2xl p-8 md:p-12 border-rose-500/50 shadow-2xl shadow-rose-900/50 bg-white/10 text-center">
        
        <div className="mx-auto w-24 h-24 bg-rose-500/20 text-rose-500 rounded-full flex items-center justify-center mb-6 animate-bounce shadow-lg shadow-rose-500/20 border border-rose-500/30">
          <AlertTriangle size={48} strokeWidth={2.5} />
        </div>

        <h1 className="text-4xl md:text-5xl font-black text-white tracking-tight mb-4">
          Medical Emergency Detected
        </h1>
        
        <p className="text-rose-200 text-lg font-medium mb-8 max-w-xl mx-auto">
          You mentioned <span className="text-white font-bold px-2 py-0.5 bg-rose-500/40 rounded-md">"{triggerWord}"</span>. 
          AI Agents are not equipped to handle life-threatening situations. Please contact emergency services immediately.
        </p>

        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-10 text-left">
          {/* Ambulance Card */}
          <div className="bg-rose-900/40 border border-rose-500/30 p-5 rounded-2xl flex items-center justify-between group hover:bg-rose-800/50 transition-colors cursor-pointer">
            <div>
              <p className="text-rose-300 text-xs font-bold uppercase tracking-widest mb-1">Ambulance / Medical</p>
              <p className="text-3xl font-black text-white">108</p>
            </div>
            <div className="p-3 bg-rose-500 text-white rounded-xl shadow-md group-hover:scale-110 transition-transform">
              <PhoneCall size={24} />
            </div>
          </div>

          {/* Poison Control Card */}
          <div className="bg-rose-900/40 border border-rose-500/30 p-5 rounded-2xl flex items-center justify-between group hover:bg-rose-800/50 transition-colors cursor-pointer">
            <div>
              <p className="text-rose-300 text-xs font-bold uppercase tracking-widest mb-1">Poison Control</p>
              <p className="text-3xl font-black text-white">1066</p>
            </div>
            <div className="p-3 bg-amber-500 text-white rounded-xl shadow-md group-hover:scale-110 transition-transform">
              <ShieldAlert size={24} />
            </div>
          </div>
        </div>

        <div className="flex justify-center">
          <button 
            onClick={onClose}
            className="flex items-center gap-2 px-6 py-3 rounded-full bg-white/10 hover:bg-white/20 text-white font-semibold border border-white/20 transition-all active:scale-95"
          >
            <ArrowLeft size={18} /> Acknowledge & Return to Chat
          </button>
        </div>
      </div>
    </div>
  );
};

export default EmergencyOverlay;
</file>

<file path="components/Chat/MessageBubble.jsx">

</file>

<file path="components/Chat/PrescriptionUpload.jsx">
import { useState, useRef } from 'react';
import { UploadCloud, FileText, X, CheckCircle2, AlertCircle, Loader2 } from 'lucide-react';

const PrescriptionUpload = ({ isOpen, onClose, onUploadComplete }) => {
  const [dragActive, setDragActive] = useState(false);
  const [file, setFile] = useState(null);
  const [uploadState, setUploadState] = useState('idle'); // idle, uploading, success, error
  const inputRef = useRef(null);

  if (!isOpen) return null;

  const handleDrag = (e) => {
    e.preventDefault();
    e.stopPropagation();
    if (e.type === "dragenter" || e.type === "dragover") setDragActive(true);
    else if (e.type === "dragleave") setDragActive(false);
  };

  const validateAndSetFile = (selectedFile) => {
    const validTypes = ['application/pdf', 'image/jpeg', 'image/png'];
    if (selectedFile && validTypes.includes(selectedFile.type)) {
      setFile(selectedFile);
      setUploadState('idle');
    } else {
      setFile(null);
      setUploadState('error');
    }
  };

  const handleDrop = (e) => {
    e.preventDefault();
    e.stopPropagation();
    setDragActive(false);
    if (e.dataTransfer.files && e.dataTransfer.files[0]) {
      validateAndSetFile(e.dataTransfer.files[0]);
    }
  };

  const handleChange = (e) => {
    e.preventDefault();
    if (e.target.files && e.target.files[0]) {
      validateAndSetFile(e.target.files[0]);
    }
  };

  const simulateUpload = () => {
    if (!file) return;
    setUploadState('uploading');
    
    // Simulate backend processing time
    setTimeout(() => {
      setUploadState('success');
      setTimeout(() => {
        onUploadComplete(file.name);
        onClose();
        setFile(null);
        setUploadState('idle');
      }, 1500); // Close automatically after showing success
    }, 2000);
  };

  return (
    <div className="fixed inset-0 z-[90] flex items-center justify-center p-4 bg-slate-900/40 backdrop-blur-md animate-in fade-in duration-300">
      <div className="glass-panel w-full max-w-md p-8 relative shadow-2xl animate-in zoom-in-95 duration-300 bg-white/70">
        
        <button 
          onClick={onClose}
          className="absolute top-4 right-4 p-2 bg-white/50 hover:bg-white rounded-full text-slate-500 transition-colors"
        >
          <X size={20} />
        </button>

        <div className="text-center mb-6 mt-2">
          <h2 className="text-2xl font-extrabold text-slate-800 tracking-tight">Upload Prescription</h2>
          <p className="text-sm text-slate-500 mt-1 font-medium">Valid formats: PDF, JPG, PNG</p>
        </div>

        {uploadState === 'success' ? (
          <div className="flex flex-col items-center justify-center py-10 animate-in zoom-in duration-500">
            <div className="w-20 h-20 bg-emerald-100 text-emerald-500 rounded-full flex items-center justify-center mb-4 shadow-inner">
              <CheckCircle2 size={40} strokeWidth={2.5} />
            </div>
            <h3 className="text-xl font-bold text-slate-800">Upload Complete</h3>
            <p className="text-sm text-slate-500 mt-1">Analyzing Rx data...</p>
          </div>
        ) : (
          <>
            <form 
              onDragEnter={handleDrag} onDragLeave={handleDrag} onDragOver={handleDrag} onDrop={handleDrop}
              onClick={() => inputRef.current.click()}
              className={`relative flex flex-col items-center justify-center w-full h-48 border-2 border-dashed rounded-3xl cursor-pointer transition-all duration-300 group ${
                dragActive ? 'border-emerald-500 bg-emerald-50/50' : 'border-slate-300 hover:border-emerald-400 bg-white/30 hover:bg-white/50'
              }`}
            >
              <input ref={inputRef} type="file" accept=".pdf,.png,.jpg,.jpeg" onChange={handleChange} className="hidden" />
              
              <div className="p-4 bg-white shadow-sm rounded-full mb-3 group-hover:scale-110 group-hover:shadow-md transition-all">
                <UploadCloud size={32} className={dragActive ? 'text-emerald-500' : 'text-slate-400 group-hover:text-emerald-500'} />
              </div>
              <p className="text-sm font-bold text-slate-700">Drag & drop your file here</p>
              <p className="text-xs text-slate-400 mt-1 font-medium">or click to browse files</p>
            </form>

            {/* Error Message */}
            {uploadState === 'error' && (
              <div className="flex items-center gap-2 mt-4 p-3 bg-rose-50 text-rose-600 rounded-xl text-xs font-bold border border-rose-100">
                <AlertCircle size={16} /> Invalid file format. Please upload a PDF or Image.
              </div>
            )}

            {/* Selected File Preview */}
            {file && uploadState !== 'error' && (
              <div className="flex items-center justify-between mt-4 p-3 bg-white/60 border border-white/80 rounded-2xl shadow-sm">
                <div className="flex items-center gap-3 overflow-hidden">
                  <div className="p-2 bg-blue-100 text-blue-600 rounded-lg">
                    <FileText size={18} />
                  </div>
                  <span className="text-sm font-semibold text-slate-700 truncate">{file.name}</span>
                </div>
                <button 
                  onClick={(e) => { e.stopPropagation(); setFile(null); }}
                  className="p-1.5 text-slate-400 hover:text-rose-500 rounded-md transition-colors"
                >
                  <X size={16} />
                </button>
              </div>
            )}

            <button 
              onClick={simulateUpload}
              disabled={!file || uploadState === 'uploading'}
              className="w-full mt-6 bg-slate-800 hover:bg-slate-700 disabled:bg-slate-300 text-white p-4 rounded-2xl font-bold text-[15px] shadow-lg flex items-center justify-center gap-2 transition-all active:scale-[0.98]"
            >
              {uploadState === 'uploading' ? (
                <><Loader2 size={18} className="animate-spin" /> Processing File...</>
              ) : (
                'Secure Upload'
              )}
            </button>
          </>
        )}
      </div>
    </div>
  );
};

export default PrescriptionUpload;
</file>

<file path="components/Chat/QuickActions.jsx">
import { Search, ShoppingBag, Pill, FileText } from 'lucide-react';

const QuickActions = ({ onAction }) => {
  const actions = [
    { 
      label: 'Browse Storefront', 
      icon: <ShoppingBag size={22} className="text-emerald-500" />, 
      prompt: 'I want to browse the available medicines in the store.',
      desc: 'Live inventory & pricing'
    },
    { 
      label: 'Refill Check', 
      icon: <Pill size={22} className="text-blue-500" />, 
      prompt: 'I need to check if I am eligible for a proactive refill.',
      desc: 'AI history analysis'
    },
    { 
      label: 'Symptom Triage', 
      icon: <Search size={22} className="text-purple-500" />, 
      prompt: 'I have some symptoms. Can you analyze them?',
      desc: 'Consult the GP Agent'
    },
    { 
      label: 'Upload RX', 
      icon: <FileText size={22} className="text-amber-500" />, 
      prompt: 'I have a prescription file I need to upload.',
      desc: 'PDF, PNG, JPG support'
    }
  ];

  return (
    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 w-full max-w-2xl mx-auto mt-10">
      {actions.map((action, idx) => (
        <button
          key={idx}
          onClick={() => onAction(action.prompt)}
          className="relative overflow-hidden glass-panel p-5 text-left group transition-all duration-500 hover:scale-[1.02] hover:bg-white/60 active:scale-[0.98] border-white/60"
        >
          {/* Subtle hover glare effect */}
          <div className="absolute inset-0 bg-gradient-to-tr from-transparent via-white/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-700 translate-x-[-100%] group-hover:translate-x-[100%]"></div>
          
          <div className="flex items-start gap-4 relative z-10">
            <div className="p-3 rounded-2xl bg-white shadow-sm border border-slate-100 group-hover:shadow-md transition-shadow">
              {action.icon}
            </div>
            <div className="pt-1">
              <h3 className="font-bold text-slate-800 tracking-tight">{action.label}</h3>
              <p className="text-[11px] text-slate-500 mt-1 uppercase tracking-widest font-bold opacity-70 group-hover:opacity-100 transition-opacity">
                {action.desc}
              </p>
            </div>
          </div>
        </button>
      ))}
    </div>
  );
};

export default QuickActions;
</file>

<file path="components/Chat/VoiceInput.jsx">

</file>

<file path="components/Store/CartDrawer.jsx">
import { X, Trash2, CreditCard, ShoppingCart } from 'lucide-react';
import { usePharmacy } from '../../context/PharmacyContext';

const CartDrawer = ({ isOpen, onClose }) => {
  const { cart, setCart } = usePharmacy();

  // Calculate the grand total
  const grandTotal = cart.reduce((sum, item) => sum + item.price, 0);

  const handleRemove = (indexToRemove) => {
    setCart(cart.filter((_, idx) => idx !== indexToRemove));
  };

  const handleCheckout = () => {
    alert("This will trigger the AI Checkout Prompt and PayPal generation!");
    // We will wire this to the backend Billing Agent later!
  };

  return (
    <>
      {/* Dark blurred overlay behind the drawer */}
      <div 
        className={`fixed inset-0 bg-black/20 backdrop-blur-sm z-[60] transition-opacity duration-500 ${isOpen ? 'opacity-100' : 'opacity-0 pointer-events-none'}`}
        onClick={onClose}
      ></div>

      {/* The Glass Drawer sliding from the right */}
      <div className={`fixed top-0 right-0 h-full w-full max-w-md glass-panel !rounded-none !rounded-l-[40px] z-[70] flex flex-col transform transition-transform duration-500 ease-[cubic-bezier(0.32,0.72,0,1)] ${isOpen ? 'translate-x-0' : 'translate-x-full'}`}>
        
        {/* Drawer Header */}
        <div className="flex items-center justify-between p-6 border-b border-white/40">
          <div className="flex items-center gap-3">
            <div className="p-2 bg-emerald-100 text-emerald-600 rounded-xl">
              <ShoppingCart size={24} />
            </div>
            <h2 className="text-2xl font-extrabold text-slate-800 tracking-tight">Your Cart</h2>
          </div>
          <button 
            onClick={onClose}
            className="p-2 bg-white/50 hover:bg-white border border-white/60 rounded-full text-slate-500 hover:text-slate-800 transition-all active:scale-95 shadow-sm"
          >
            <X size={20} />
          </button>
        </div>

        {/* Cart Items Area */}
        <div className="flex-1 overflow-y-auto p-6 space-y-4">
          {cart.length === 0 ? (
            <div className="flex flex-col items-center justify-center h-full text-slate-400 gap-4 opacity-70">
              <ShoppingCart size={48} strokeWidth={1} />
              <p className="font-medium text-lg">Your cart is empty.</p>
            </div>
          ) : (
            cart.map((item, idx) => (
              <div key={idx} className="bg-white/60 backdrop-blur-md border border-white/80 p-4 rounded-3xl shadow-sm flex items-center justify-between group hover:bg-white/80 transition-colors">
                <div>
                  <h4 className="font-bold text-slate-800">{item.name}</h4>
                  <p className="text-xs font-semibold text-slate-500 mt-0.5 uppercase tracking-wider">{item.category}</p>
                </div>
                <div className="flex items-center gap-4">
                  <span className="font-extrabold text-slate-800">${item.price.toFixed(2)}</span>
                  <button 
                    onClick={() => handleRemove(idx)}
                    className="p-2 text-rose-400 hover:text-rose-600 hover:bg-rose-50 rounded-full transition-colors opacity-0 group-hover:opacity-100"
                  >
                    <Trash2 size={18} />
                  </button>
                </div>
              </div>
            ))
          )}
        </div>

        {/* Sticky Checkout Footer */}
        {cart.length > 0 && (
          <div className="p-6 bg-white/40 backdrop-blur-xl border-t border-white/50">
            <div className="flex justify-between items-center mb-6">
              <span className="text-slate-500 font-semibold uppercase tracking-wider text-sm">Grand Total</span>
              <span className="text-3xl font-black text-slate-800">${grandTotal.toFixed(2)}</span>
            </div>
            
            <button 
              onClick={handleCheckout}
              className="w-full py-4 bg-slate-800 hover:bg-slate-700 text-white rounded-2xl font-bold text-lg shadow-xl shadow-slate-800/20 flex items-center justify-center gap-2 active:scale-[0.98] transition-all"
            >
              <CreditCard size={20} /> Checkout Securely
            </button>
          </div>
        )}
      </div>
    </>
  );
};

export default CartDrawer;
</file>

<file path="components/Store/ProductGrid.jsx">
import { ShoppingCart, AlertCircle, FileText } from 'lucide-react';
import { usePharmacy } from '../../context/PharmacyContext';

const MOCK_INVENTORY = [
  { id: 1, name: 'Paracetamol 500mg', price: 4.99, category: 'OTC', stock: 45, requiresRx: false, desc: 'Fever and pain relief.' },
  { id: 2, name: 'Amoxicillin 250mg', price: 12.50, category: 'Antibiotic', stock: 12, requiresRx: true, desc: 'Bacterial infection treatment.' },
  { id: 3, name: 'Vitamin C Complex', price: 18.00, category: 'Supplement', stock: 0, requiresRx: false, desc: 'Immune system support.' },
  { id: 4, name: 'Loratadine 10mg', price: 8.99, category: 'Allergy', stock: 30, requiresRx: false, desc: 'Non-drowsy allergy relief.' },
];

const ProductGrid = ({ searchQuery, activeCategory }) => {
  const { cart, setCart } = usePharmacy();

  const handleAddToCart = (product) => {
    // We'll wire up the proper cart drawer later, for now just log it
    console.log("Added to cart:", product.name);
    setCart([...cart, product]);
  };

  const filteredProducts = MOCK_INVENTORY.filter(p => {
    const matchesSearch = p.name.toLowerCase().includes(searchQuery.toLowerCase());
    const matchesCategory = activeCategory === 'All' || p.category === activeCategory;
    return matchesSearch && matchesCategory;
  });

  return (
    <div className="grid grid-cols-1 md:grid-cols-2 gap-5 w-full pb-20">
      {filteredProducts.map((product) => {
        const isOutOfStock = product.stock === 0;

        return (
          <div 
            key={product.id} 
            className={`glass-panel p-5 relative overflow-hidden transition-all duration-300 ${
              isOutOfStock ? 'opacity-60 grayscale-[0.5]' : 'hover:-translate-y-1 hover:shadow-xl hover:bg-white/60'
            }`}
          >
            {/* Top Badges */}
            <div className="flex justify-between items-start mb-3">
              <span className={`text-[10px] font-bold px-2.5 py-1 rounded-full uppercase tracking-wider ${
                product.requiresRx ? 'bg-amber-100 text-amber-700' : 'bg-emerald-100 text-emerald-700'
              }`}>
                {product.requiresRx ? 'Rx Required' : 'OTC'}
              </span>
              
              <span className={`text-xs font-semibold ${isOutOfStock ? 'text-red-500' : 'text-slate-500'}`}>
                {isOutOfStock ? 'Out of Stock' : `${product.stock} in stock`}
              </span>
            </div>

            <h3 className="text-lg font-bold text-slate-800 tracking-tight">{product.name}</h3>
            <p className="text-sm text-slate-500 mt-1 mb-4 line-clamp-2">{product.desc}</p>

            <div className="flex items-center justify-between mt-auto pt-3 border-t border-slate-200/50">
              <span className="text-xl font-extrabold text-slate-800">${product.price.toFixed(2)}</span>
              
              {product.requiresRx ? (
                <button className="flex items-center gap-1.5 px-4 py-2 bg-amber-500 hover:bg-amber-600 text-white text-sm font-semibold rounded-full shadow-sm transition-colors active:scale-95">
                  <FileText size={16} /> Upload Rx
                </button>
              ) : (
                <button 
                  disabled={isOutOfStock}
                  onClick={() => handleAddToCart(product)}
                  className={`flex items-center gap-1.5 px-4 py-2 text-sm font-semibold rounded-full shadow-sm transition-all active:scale-95 ${
                    isOutOfStock 
                    ? 'bg-slate-200 text-slate-400 cursor-not-allowed' 
                    : 'bg-slate-800 hover:bg-slate-700 text-white'
                  }`}
                >
                  <ShoppingCart size={16} /> {isOutOfStock ? 'Unavailable' : 'Add to Cart'}
                </button>
              )}
            </div>
          </div>
        );
      })}
    </div>
  );
};

export default ProductGrid;
</file>

<file path="components/UI/Loader.jsx">

</file>

<file path="components/UI/Navbar.jsx">
import { useState } from 'react';
import { usePharmacy } from '../../context/PharmacyContext';
import { Pill, ShoppingBag, RotateCcw, User, ShoppingCart, Activity } from 'lucide-react';
import CartDrawer from '../Store/CartDrawer';

const Navbar = ({ activeTab, setActiveTab }) => {
  const { patient, setMessages, setAgentStatus, cart } = usePharmacy();
  const [isCartOpen, setIsCartOpen] = useState(false);

  const handleReset = () => {
    setMessages([]);
    setAgentStatus({
      orchestrator: 'idle', pharmacist: 'idle', physician: 'idle',
      regulatory: 'idle', inventory: 'idle', billing: 'idle', refill: 'idle'
    });
  };

  return (
    <>
      <div className="w-full flex justify-center pt-6 px-4 z-50 sticky top-0">
        <nav className="glass-panel w-full max-w-6xl px-5 py-3 flex items-center justify-between rounded-full border-white/60">
          
          {/* Brand */}
          <div className="flex items-center gap-3">
            <div className="bg-emerald-500/10 p-2 rounded-full border border-emerald-500/20">
              <Pill size={20} className="text-emerald-600" strokeWidth={2.5} />
            </div>
            <span className="text-lg font-bold tracking-tight text-slate-800 hidden sm:block">
              PharmaAgent <span className="font-medium text-slate-400">AI</span>
            </span>
          </div>

          {/* Center: Patient Badge */}
          <div className="hidden md:flex items-center gap-2 px-4 py-1.5 bg-black/5 rounded-full border border-black/5 shadow-inner">
            <User size={14} className="text-slate-500" />
            <span className="text-xs font-semibold text-slate-700">{patient.name}</span>
            <div className="h-3 w-px bg-slate-300 mx-1"></div>
            <span className={`text-[10px] font-bold px-2 py-0.5 rounded-full uppercase tracking-widest ${
              patient.mode === 'pediatric' ? 'bg-blue-100 text-blue-600' :
              patient.mode === 'senior' ? 'bg-amber-100 text-amber-600' : 'bg-slate-200 text-slate-600'
            }`}>
              {patient.mode}
            </span>
          </div>

          {/* Right: Actions */}
          <button 
              onClick={() => setActiveTab('admin')}
              className={`flex items-center gap-1.5 px-3 sm:px-4 py-2 rounded-full text-sm font-semibold transition-all duration-300 ${activeTab === 'admin' ? 'bg-white shadow-sm text-slate-800' : 'text-slate-500 hover:text-slate-800 hover:bg-white/40'}`}
            >
              <Activity size={16} /> <span className="hidden sm:block">Admin</span>
            </button>

          <div className="flex items-center gap-1 sm:gap-2">
            <button 
              onClick={() => setActiveTab('chat')}
              className={`px-3 sm:px-4 py-2 rounded-full text-sm font-semibold transition-all duration-300 ${activeTab === 'chat' ? 'bg-white shadow-sm text-slate-800' : 'text-slate-500 hover:text-slate-800 hover:bg-white/40'}`}
            >
              Consult
            </button>
            <button 
              onClick={() => setActiveTab('store')}
              className={`flex items-center gap-1.5 px-3 sm:px-4 py-2 rounded-full text-sm font-semibold transition-all duration-300 ${activeTab === 'store' ? 'bg-white shadow-sm text-slate-800' : 'text-slate-500 hover:text-slate-800 hover:bg-white/40'}`}
            >
              <ShoppingBag size={16} /> <span className="hidden sm:block">Store</span>
            </button>
            
            <div className="h-6 w-px bg-slate-200 mx-1"></div>

            {/* NEW: Cart Button with Badge */}
            <button 
              onClick={() => setIsCartOpen(true)}
              className="relative p-2 text-slate-600 hover:text-emerald-600 hover:bg-white/60 rounded-full transition-all"
            >
              <ShoppingCart size={20} strokeWidth={2.5} />
              {cart.length > 0 && (
                <span className="absolute top-0 right-0 w-4 h-4 bg-emerald-500 text-white text-[10px] font-bold flex items-center justify-center rounded-full border-2 border-white shadow-sm transform translate-x-1 -translate-y-1">
                  {cart.length}
                </span>
              )}
            </button>
            
            <button 
              onClick={handleReset}
              className="p-2 text-slate-400 hover:text-amber-500 hover:bg-amber-50 rounded-full transition-colors"
              title="Reset Session"
            >
              <RotateCcw size={18} strokeWidth={2.5} />
            </button>
          </div>
        </nav>
      </div>

      {/* Mount the Drawer */}
      <CartDrawer isOpen={isCartOpen} onClose={() => setIsCartOpen(false)} />
    </>
  );
};

export default Navbar;
</file>

<file path="context/PharmacyContext.jsx">
import { createContext, useContext, useState } from 'react';

const PharmacyContext = createContext();

export const PharmacyProvider = ({ children }) => {
  // 1. Patient Session State
  const [patient, setPatient] = useState({ name: '', age: '', mode: 'standard' });
  const [isAuth, setIsAuth] = useState(false);

  // 2. Chat & 7-Agent Status Tracking
  const [messages, setMessages] = useState([]);
  const [agentStatus, setAgentStatus] = useState({
    orchestrator: 'idle',
    pharmacist: 'idle',
    physician: 'idle',
    regulatory: 'idle',
    inventory: 'idle',
    billing: 'idle',
    refill: 'idle'
  });

  // 3. Storefront & Cart Persistence
  const [cart, setCart] = useState([]);

  return (
    <PharmacyContext.Provider value={{ 
      patient, setPatient, 
      isAuth, setIsAuth, 
      messages, setMessages,
      agentStatus, setAgentStatus,
      cart, setCart 
    }}>
      {children}
    </PharmacyContext.Provider>
  );
};

export const usePharmacy = () => useContext(PharmacyContext);
</file>

<file path="hooks/useAgent.js">

</file>

<file path="hooks/useAgentStream.js">

</file>

<file path="index.css">
@import "tailwindcss";

:root {
  /* Apple-style Glass Variables */
  --glass-bg: rgba(255, 255, 255, 0.4);
  --glass-border: rgba(255, 255, 255, 0.5);
  --glass-shadow: 0 24px 40px -10px rgba(0, 0, 0, 0.08);
  
  /* Liquid Accents for the floating blobs */
  --liquid-mint: #d1fae5;
  --liquid-blue: #dbeafe;
}

body {
  margin: 0;
  min-height: 100vh;
  /* Premium Abstract White/Grey Photo Background */
  background-color: #f5f5f7;
  background-image: 
    linear-gradient(to bottom, rgba(255,255,255,0.4), rgba(255,255,255,0.8)),
    url('https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=2564&auto=format&fit=crop');
  background-size: cover;
  background-position: center;
  background-attachment: fixed;
  font-family: 'Inter', system-ui, -apple-system, sans-serif;
  color: #1d1d1f; 
  -webkit-font-smoothing: antialiased;
}

/* Ultra-Premium Glass Class */
.glass-panel {
  background: var(--glass-bg);
  backdrop-filter: blur(24px) saturate(200%);
  -webkit-backdrop-filter: blur(24px) saturate(200%);
  border: 1px solid var(--glass-border);
  box-shadow: var(--glass-shadow), inset 0 1px 0 rgba(255, 255, 255, 0.6);
  border-radius: 32px;
}

/* Background Animation */
.liquid-blob {
  position: fixed;
  width: 50vw;
  height: 50vw;
  background: radial-gradient(circle, rgba(16, 185, 129, 0.05) 0%, transparent 70%);
  filter: blur(60px);
  z-index: -1;
  animation: float 20s infinite alternate ease-in-out;
}

@keyframes float {
  from { transform: translate(-10%, -10%) rotate(0deg); }
  to { transform: translate(15%, 15%) rotate(15deg); }
}
</file>

<file path="main.jsx">
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.jsx'
import { PharmacyProvider } from './context/PharmacyContext'

createRoot(document.getElementById('root')).render(
  <StrictMode>
    <PharmacyProvider>
      <App />
    </PharmacyProvider>
  </StrictMode>,
)
</file>

<file path="pages/AdminPortal.jsx">
import { useState } from 'react';
import { Activity, ShieldAlert, Database, Zap, FileText, AlertTriangle, CheckCircle2 } from 'lucide-react';

const AdminPortal = () => {
  const [activeTab, setActiveTab] = useState('overview');

  const tabs = [
    { id: 'overview', label: 'Risk & Analytics', icon: Activity },
    { id: 'langfuse', label: 'Langfuse Metrics', icon: Zap },
    { id: 'prescriptions', label: 'Rx Queue', icon: FileText },
    { id: 'inventory', label: 'Live Stock', icon: Database },
  ];

  return (
    <div className="w-full max-w-6xl mx-auto p-4 flex flex-col h-[calc(100vh-100px)] animate-in fade-in duration-700">
      
      {/* Admin Header */}
      <div className="mb-6 mt-2 flex items-end justify-between">
        <div>
          <div className="flex items-center gap-2 mb-2">
            <span className="bg-rose-100 text-rose-600 px-2.5 py-1 rounded-full text-[10px] font-extrabold uppercase tracking-widest flex items-center gap-1">
              <ShieldAlert size={12} /> Admin Authorization Level 4
            </span>
          </div>
          <h1 className="text-3xl font-extrabold text-slate-800 tracking-tight">System Intelligence</h1>
        </div>
      </div>

      {/* Admin 4-Tab Navigation */}
      <div className="flex items-center gap-3 mb-6 overflow-x-auto pb-2 scrollbar-hide">
        {tabs.map(tab => {
          const Icon = tab.icon;
          const isActive = activeTab === tab.id;
          return (
            <button
              key={tab.id}
              onClick={() => setActiveTab(tab.id)}
              className={`flex items-center gap-2 px-5 py-2.5 rounded-2xl text-sm font-semibold whitespace-nowrap transition-all duration-300 ${
                isActive 
                ? 'bg-slate-800 text-white shadow-lg shadow-slate-800/20' 
                : 'glass-panel text-slate-600 hover:bg-white/80 active:scale-95'
              }`}
            >
              <Icon size={16} className={isActive ? 'text-emerald-400' : 'text-slate-400'} /> 
              {tab.label}
            </button>
          );
        })}
      </div>

      {/* Tab Content Area */}
      <div className="flex-1 overflow-y-auto pr-2 pb-10 space-y-6">
        
        {/* TAB 1: OVERVIEW (Risk & Analytics) */}
        {activeTab === 'overview' && (
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            {/* PDC Risk Gauge (Simulated with UI) */}
            <div className="glass-panel p-6 flex flex-col justify-between">
              <div>
                <h3 className="text-lg font-bold text-slate-800 mb-1">PDC Risk Gauge</h3>
                <p className="text-xs text-slate-500 font-medium">Proportion of Days Covered - Patient Adherence</p>
              </div>
              <div className="flex items-center justify-center py-8">
                <div className="relative w-48 h-48 rounded-full border-[16px] border-slate-100 flex items-center justify-center shadow-inner">
                  <div className="absolute inset-[-16px] rounded-full border-[16px] border-emerald-400 border-t-transparent border-l-transparent rotate-45"></div>
                  <div className="text-center">
                    <span className="text-4xl font-black text-slate-800">82%</span>
                    <p className="text-xs font-bold text-emerald-500 uppercase tracking-widest mt-1">Safe Zone</p>
                  </div>
                </div>
              </div>
            </div>

            {/* Red Route Analytics */}
            <div className="glass-panel p-6">
              <h3 className="text-lg font-bold text-slate-800 mb-4">Red Route Triggers</h3>
              <div className="space-y-4">
                {[
                  { label: 'Emergency Keywords Detected', count: 12, color: 'bg-rose-500', w: 'w-[15%]' },
                  { label: 'Contraindication Alerts', count: 45, color: 'bg-amber-500', w: 'w-[45%]' },
                  { label: 'Pediatric Dosage Adjustments', count: 89, color: 'bg-blue-500', w: 'w-[80%]' }
                ].map((stat, i) => (
                  <div key={i}>
                    <div className="flex justify-between text-xs font-bold text-slate-600 mb-1">
                      <span>{stat.label}</span>
                      <span>{stat.count} Events</span>
                    </div>
                    <div className="h-2 w-full bg-slate-100 rounded-full overflow-hidden">
                      <div className={`h-full ${stat.color} ${stat.w} rounded-full`}></div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        )}

        {/* TAB 2: LANGFUSE METRICS */}
        {activeTab === 'langfuse' && (
          <>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
              {[
                { label: 'Total Tokens Today', value: '1.24M', icon: Database, color: 'text-purple-500', bg: 'bg-purple-100' },
                { label: 'Est. LLM Cost', value: '$4.12', icon: Activity, color: 'text-emerald-500', bg: 'bg-emerald-100' },
                { label: 'Avg Latency / Agent', value: '850ms', icon: Zap, color: 'text-amber-500', bg: 'bg-amber-100' }
              ].map((metric, i) => (
                <div key={i} className="glass-panel p-6 flex items-center gap-4">
                  <div className={`p-4 rounded-2xl ${metric.bg} ${metric.color}`}>
                    <metric.icon size={24} />
                  </div>
                  <div>
                    <p className="text-xs font-bold text-slate-500 uppercase tracking-wider">{metric.label}</p>
                    <p className="text-2xl font-black text-slate-800">{metric.value}</p>
                  </div>
                </div>
              ))}
            </div>
            
            <div className="glass-panel p-6">
              <div className="flex justify-between items-center mb-4">
                <h3 className="text-lg font-bold text-slate-800">Recent 7-Agent Traces</h3>
                <button className="text-xs font-bold bg-slate-100 hover:bg-slate-200 px-3 py-1.5 rounded-full transition-colors">
                  Open Langfuse Cloud 
                </button>
              </div>
              <div className="w-full overflow-x-auto">
                <table className="w-full text-left text-sm">
                  <thead>
                    <tr className="border-b border-slate-200 text-slate-500">
                      <th className="pb-3 font-semibold">Trace ID</th>
                      <th className="pb-3 font-semibold">Patient</th>
                      <th className="pb-3 font-semibold">Agents Called</th>
                      <th className="pb-3 font-semibold">Latency</th>
                      <th className="pb-3 font-semibold">Status</th>
                    </tr>
                  </thead>
                  <tbody className="text-slate-700 font-medium">
                    {[
                      { id: 'tr_8f92a1', name: 'Atharva B.', agents: 4, time: '3.2s', status: 'Success' },
                      { id: 'tr_4c22b9', name: 'Sarah J.', agents: 7, time: '5.8s', status: 'Success' },
                      { id: 'tr_1a09d3', name: 'Mike T.', agents: 2, time: '1.1s', status: 'Emergency Route' }
                    ].map((row, i) => (
                      <tr key={i} className="border-b border-slate-100 hover:bg-white/40 transition-colors">
                        <td className="py-3 font-mono text-xs text-slate-500">{row.id}</td>
                        <td className="py-3">{row.name}</td>
                        <td className="py-3">
                          <span className="bg-slate-100 px-2 py-1 rounded-md">{row.agents} sequential</span>
                        </td>
                        <td className="py-3">{row.time}</td>
                        <td className="py-3">
                          <span className={`flex items-center gap-1 text-xs font-bold ${row.status === 'Success' ? 'text-emerald-500' : 'text-rose-500'}`}>
                            {row.status === 'Success' ? <CheckCircle2 size={14} /> : <AlertTriangle size={14} />} {row.status}
                          </span>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </div>
          </>
        )}

        {/* TAB 3 & 4 Placeholders to keep it clean for now */}
        {(activeTab === 'prescriptions' || activeTab === 'inventory') && (
          <div className="glass-panel p-12 flex flex-col items-center justify-center text-slate-400">
            <Database size={48} className="mb-4 opacity-50" strokeWidth={1} />
            <h2 className="text-xl font-bold text-slate-600">Secure Database Connected</h2>
            <p className="text-sm mt-2 text-center max-w-md">Table data syncing from backend API. Fast UI rendering complete.</p>
          </div>
        )}

      </div>
    </div>
  );
};

export default AdminPortal;
</file>

<file path="pages/Onboarding.jsx">
import { useState } from 'react';
import { usePharmacy } from '../context/PharmacyContext';
import { ShieldCheck, User, Calendar, Baby, HeartPulse, CheckCircle2 } from 'lucide-react';

const Onboarding = () => {
  const { setPatient, setIsAuth } = usePharmacy();
  const [formData, setFormData] = useState({ firstName: '', lastName: '', age: '', terms: false });

  // Dynamic calculations for the safety banners
  const ageNum = parseInt(formData.age);
  const isPediatric = ageNum > 0 && ageNum < 18;
  const isSenior = ageNum >= 65;
  const isReady = formData.firstName && formData.lastName && formData.age && formData.terms;

  const handleSubmit = (e) => {
    e.preventDefault();
    if (isReady) {
      const mode = isPediatric ? 'pediatric' : isSenior ? 'senior' : 'standard';
      
      // Save patient to the global context
      setPatient({ 
        name: `${formData.firstName.trim()} ${formData.lastName.trim()}`, 
        age: ageNum, 
        mode 
      });
      // Unlock the app
      setIsAuth(true);
    }
  };

  return (
    <div className="glass-panel max-w-lg w-full p-8 md:p-10 shadow-2xl animate-in fade-in zoom-in-95 duration-500">
      <div className="flex flex-col items-center text-center mb-8">
        <div className="h-16 w-16 bg-gradient-to-br from-emerald-400 to-teal-500 rounded-2xl flex items-center justify-center shadow-lg shadow-emerald-200 mb-6 transition-transform hover:scale-105">
          <ShieldCheck size={32} className="text-white" />
        </div>
        <h1 className="text-3xl font-extrabold text-slate-800 tracking-tight">Patient Intake</h1>
        <p className="text-slate-500 mt-2 font-medium">Secure AI Pharmacy Registration</p>
      </div>

      <form onSubmit={handleSubmit} className="space-y-5">
        <div className="grid grid-cols-2 gap-4">
          <div className="relative group">
            <User size={18} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-emerald-500 transition-colors" />
            <input 
              type="text" required placeholder="First Name" 
              className="w-full bg-white/60 border border-white/50 pl-11 pr-4 py-3 rounded-xl text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2 ring-emerald-400/50 shadow-sm transition-all"
              onChange={(e) => setFormData({...formData, firstName: e.target.value})}
            />
          </div>
          <div className="relative group">
            <input 
              type="text" required placeholder="Last Name" 
              className="w-full bg-white/60 border border-white/50 px-4 py-3 rounded-xl text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2 ring-emerald-400/50 shadow-sm transition-all"
              onChange={(e) => setFormData({...formData, lastName: e.target.value})}
            />
          </div>
        </div>

        <div className="relative group">
          <Calendar size={18} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-emerald-500 transition-colors" />
          <input 
            type="number" required placeholder="Age" min="1" max="120"
            className="w-full bg-white/60 border border-white/50 pl-11 pr-4 py-3 rounded-xl text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2 ring-emerald-400/50 shadow-sm transition-all"
            onChange={(e) => setFormData({...formData, age: e.target.value})}
          />
        </div>

        {/* Dynamic Safety Banners */}
        <div className="min-h-[50px] transition-all duration-300">
          {isPediatric && (
            <div className="flex items-center gap-3 p-3 bg-blue-50/80 backdrop-blur-sm border border-blue-200 text-blue-700 rounded-xl text-sm font-semibold animate-in slide-in-from-top-2">
              <Baby size={20} className="text-blue-500" /> Pediatric Mode: Guardian supervision verified.
            </div>
          )}
          {isSenior && (
            <div className="flex items-center gap-3 p-3 bg-amber-50/80 backdrop-blur-sm border border-amber-200 text-amber-700 rounded-xl text-sm font-semibold animate-in slide-in-from-top-2">
              <HeartPulse size={20} className="text-amber-500" /> Senior Mode: Contraindication alerts boosted.
            </div>
          )}
        </div>

        <label className="flex items-start gap-3 cursor-pointer p-2 rounded-lg hover:bg-white/40 transition-colors">
          <div className="relative flex items-center mt-0.5">
            <input 
              type="checkbox" required
              className="peer w-5 h-5 appearance-none border-2 border-slate-300 rounded bg-white/50 checked:bg-emerald-500 checked:border-emerald-500 transition-all cursor-pointer"
              onChange={(e) => setFormData({...formData, terms: e.target.checked})} 
            />
            <CheckCircle2 size={16} className="absolute inset-0 m-auto text-white opacity-0 peer-checked:opacity-100 pointer-events-none transition-opacity" strokeWidth={3} />
          </div>
          <span className="text-sm text-slate-600 leading-snug font-medium">
            I acknowledge the <span className="text-emerald-600 hover:underline">Terms of Service</span> and consent to AI-assisted medical triage.
          </span>
        </label>

        <button 
          type="submit" 
          disabled={!isReady}
          className="w-full mt-4 bg-emerald-500 hover:bg-emerald-600 text-white p-4 rounded-xl font-bold text-lg shadow-xl shadow-emerald-500/20 transition-all disabled:opacity-50 disabled:hover:bg-emerald-500 disabled:cursor-not-allowed active:scale-[0.98]"
        >
          Initialize Session
        </button>
      </form>
    </div>
  );
};

export default Onboarding;
</file>

<file path="pages/Storefront.jsx">
import { useState } from 'react';
import ProductGrid from '../components/Store/ProductGrid';
import { Search, SlidersHorizontal } from 'lucide-react';

const Storefront = () => {
  const [searchQuery, setSearchQuery] = useState('');
  const [activeCategory, setActiveCategory] = useState('All');
  
  const categories = ['All', 'OTC', 'Antibiotic', 'Supplement', 'Allergy'];

  return (
    <div className="w-full max-w-5xl mx-auto p-4 flex flex-col h-[calc(100vh-100px)] animate-in fade-in duration-700">
      
      {/* Premium Header & Search */}
      <div className="mb-6 mt-2">
        <h1 className="text-3xl font-extrabold text-slate-800 tracking-tight mb-4">Pharmacy Inventory</h1>
        
        <div className="flex flex-col md:flex-row gap-4">
          <div className="relative flex-1 group">
            <Search className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-emerald-500 transition-colors" size={20} />
            <input 
              type="text" 
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              placeholder="Search for medications, supplements..." 
              className="w-full glass-panel pl-12 pr-4 py-3.5 rounded-2xl text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2 ring-emerald-400/50 shadow-sm transition-all text-[15px] border-white/60"
            />
          </div>
          
          <button className="glass-panel px-5 py-3.5 rounded-2xl flex items-center gap-2 text-slate-700 font-semibold hover:bg-white/60 transition-all active:scale-95">
            <SlidersHorizontal size={18} /> Filters
          </button>
        </div>

        {/* Category Pills */}
        <div className="flex items-center gap-2 mt-4 overflow-x-auto pb-2 scrollbar-hide">
          {categories.map(cat => (
            <button
              key={cat}
              onClick={() => setActiveCategory(cat)}
              className={`px-4 py-1.5 rounded-full text-sm font-semibold whitespace-nowrap transition-all ${
                activeCategory === cat 
                ? 'bg-slate-800 text-white shadow-md' 
                : 'bg-white/50 text-slate-600 hover:bg-white/80 border border-white/60 shadow-sm'
              }`}
            >
              {cat}
            </button>
          ))}
        </div>
      </div>

      {/* The Scrollable Grid Area */}
      <div className="flex-1 overflow-y-auto scroll-smooth pr-2">
        <ProductGrid searchQuery={searchQuery} activeCategory={activeCategory} />
      </div>

    </div>
  );
};

export default Storefront;
</file>

<file path="pages/UserChat.jsx">
import { useState } from 'react';
import { usePharmacy } from '../context/PharmacyContext';
import QuickActions from '../components/Chat/QuickActions';
import AgentExpander from '../components/Chat/AgentExpander';
import EmergencyOverlay from '../components/Chat/EmergencyOverlay';
import PrescriptionUpload from '../components/Chat/PrescriptionUpload';
import { Send, Mic, Sparkles, Paperclip } from 'lucide-react';

const UserChat = () => {
  const { patient, messages, setMessages } = usePharmacy();
  
  // All our state variables
  const [input, setInput] = useState('');
  const [emergencyWord, setEmergencyWord] = useState(null);
  const [isUploadOpen, setIsUploadOpen] = useState(false);

  const handleSend = (text) => {
    const messageText = text || input;
    if (!messageText.trim()) return;

    // 1. EMERGENCY KEYWORD DETECTION
    const emergencyKeywords = ['heart attack', 'poison', 'suicide', 'bleeding', 'stroke', 'chest pain'];
    const detectedWord = emergencyKeywords.find(word => messageText.toLowerCase().includes(word));
    
    if (detectedWord) {
      setEmergencyWord(detectedWord);
      setInput('');
      return; // Stop the message from sending to the AI
    }

    // 2. Normal Message Sending
    setMessages(prev => [...prev, { role: 'user', content: messageText }]);
    setInput('');
  };

  const handleUploadComplete = (fileName) => {
    // Drop a system message into the chat confirming the upload
    setMessages(prev => [
      ...prev, 
      { role: 'user', content: `Uploaded prescription document: ${fileName}` },
      { role: 'assistant', content: `I have received your prescription document (${fileName}). The Pharmacist Agent is currently analyzing it to verify dosage and drug interactions.` }
    ]);
  };

  return (
    <div className="flex flex-col h-[calc(100vh-100px)] w-full max-w-5xl mx-auto p-4">
      
      {/* Dynamic View: Quick Actions vs Chat History */}
      {messages.length === 0 ? (
        <div className="flex-1 flex flex-col items-center justify-center text-center animate-in fade-in duration-1000">
          <div className="bg-white/60 p-4 rounded-3xl shadow-sm border border-white/80 mb-6">
            <Sparkles className="text-emerald-500" size={32} />
          </div>
          <h1 className="text-4xl md:text-5xl font-extrabold text-slate-800 tracking-tight mb-3">
            Welcome, {patient?.name?.split(' ')[0] || 'Patient'}
          </h1>
          <p className="text-lg text-slate-500 font-medium mb-8">
            How can the AI Pharmacist assist you today?
          </p>
          
          <QuickActions onAction={handleSend} />
        </div>
      ) : (
        <div className="flex-1 overflow-y-auto p-4 space-y-6 scroll-smooth">
          {messages.map((msg, idx) => (
            <div key={idx}>
              {/* Message Bubble */}
              <div className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                <div className={`max-w-[75%] p-5 shadow-sm text-[15px] leading-relaxed ${
                  msg.role === 'user' 
                  ? 'bg-slate-800 text-white rounded-3xl rounded-tr-sm' 
                  : 'glass-panel rounded-3xl rounded-tl-sm text-slate-800'
                }`}>
                  {msg.content}
                </div>
              </div>

              {/* The Agent Expander Chain of Thought */}
              {msg.role === 'user' && idx === messages.length - 1 && (
                <div className="flex justify-start mt-3">
                  <AgentExpander 
                    activeAgents={{ orchestrator: 'done', physician: 'thinking', pharmacist: 'idle' }} 
                    traces={{ orchestrator: "Routed to General Physician for symptom analysis." }}
                  />
                </div>
              )}
            </div>
          ))}
        </div>
      )}

      {/* Premium Glass Input Bar */}
      <div className="pt-4 pb-2 w-full max-w-3xl mx-auto">
        <div className="glass-panel p-2 flex items-center gap-2 shadow-lg">
          <button className="p-3 text-slate-400 hover:text-emerald-500 transition-colors rounded-full hover:bg-white/50">
            <Mic size={22} />
          </button>
          
          {/* THE NEW UPLOAD BUTTON */}
          <button 
            onClick={() => setIsUploadOpen(true)}
            className="p-3 text-slate-400 hover:text-blue-500 transition-colors rounded-full hover:bg-white/50"
            title="Upload Prescription"
          >
            <Paperclip size={22} />
          </button>

          <input 
            type="text" 
            value={input}
            onChange={(e) => setInput(e.target.value)}
            onKeyDown={(e) => e.key === 'Enter' && handleSend()}
            placeholder="Describe your symptoms or ask for medication..." 
            className="flex-1 bg-transparent border-none focus:ring-0 text-slate-800 px-2 placeholder:text-slate-400 text-[15px]"
          />
          <button 
            onClick={() => handleSend()}
            className="p-3.5 bg-slate-800 text-white rounded-full shadow-md hover:bg-slate-700 transition-all active:scale-95 flex items-center justify-center"
          >
            <Send size={18} className="translate-x-[1px]" />
          </button>
        </div>
        <p className="text-center text-[11px] text-slate-400 mt-3 font-medium">
          AI agents can make mistakes. Check important medical information with a human professional.
        </p>
      </div>

      {/* RENDER THE MODALS (Hidden until triggered) */}
      <EmergencyOverlay 
        isOpen={!!emergencyWord} 
        triggerWord={emergencyWord} 
        onClose={() => setEmergencyWord(null)} 
      />
      
      <PrescriptionUpload 
        isOpen={isUploadOpen} 
        onClose={() => setIsUploadOpen(false)} 
        onUploadComplete={handleUploadComplete}
      />
    </div>
  );
};

export default UserChat;
</file>

<file path="services/api.js">

</file>

<file path="styles/LiquidGlass.css">

</file>

</files>
